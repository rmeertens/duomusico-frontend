<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Portfolio Item - Start Bootstrap Template</title>
 <script src="http://code.jquery.com/jquery-latest.js"></script>
    <script>
        var test;

        function clearData() {
             a = document.getElementById("test1");
                    a.innerHTML = "";
            for (var x = 1; x <= 4; x++) {
                //document.getElementById("spotify" + x).innerHTML = "";
            }
        }

        function myFunction() {
            //document.getElementById("loading").style.display = "";
            clearData();
            $.getJSON('http://80.60.177.158:8002/duolingorecommendation?username=' + document.getElementById("id_of_textbox").value, function(results) {
                console.log("Done with getting a response");
                console.log(results);
                test = results;
                for (var index = 0; index < results.length; index++) {
                    var nameAndArtist = results[index];
                    
                    
                    var toAdd =  "<div class=\"col-sm-6 col-md-4\">\
                       <div class=\"thumbnail\">\
        <div class=\"caption\">\
        <h3><span class=\"glyphicon glyphicon-user\" aria-hidden=\"true\"></span>   "+nameAndArtist.Artist+"</h3>\
        <h3><span class=\"glyphicon glyphicon-music\" aria-hidden=\"true\"></span>  "+nameAndArtist.NameSong+"</h3>\
        <h3><span class=\"glyphicon glyphicon-dashboard\" aria-hidden=\"true\"></span>  "+ nameAndArtist.Score+"</h3>\
      </div>\
        <div id=\"spotify"+index+"\"></div>\
    </div>\
  </div>";
                    if(index%3==2)
                    {
                        toAdd ="</div><div class=\"row\">" +toAdd;
                    }
                        
                    a = document.getElementById("test1");
                    a.innerHTML = a.innerHTML + toAdd;
                    
                    searchAlbums(nameAndArtist.NameSong + " " + nameAndArtist.Artist,index);
                }
//                document.getElementById("loading").style.display = "none";

            });
        }
      var searchAlbums = function(query, index) {
            $.ajax({
                url: 'https://api.spotify.com/v1/search',
                data: {
                    q: query,
                    type: 'track'
                },
                success: function(response) {
                    console.log("Response is: ");
                    console.log(response);

                    console.log("Element is: ");
                    console.log(index);
                    if(response.tracks.items.length>0)
                    {
                        document.getElementById("spotify" + index).innerHTML = "<iframe src=\"https://embed.spotify.com/?uri=spotify:track:" + response.tracks.items[0].id + "\" width=\"300\" height=\"380\" frameborder=\"0\" allowtransparency=\"true\"></iframe>";    
                    }
                    else
                    {
                         document.getElementById("spotify" + index).innerHTML = "<img src=\"notfound.png\" alt=\"Oh no..\" style= \"width:300px;height:380px\">"
                        
                   
                    }
                }
            });
        };
    </script>
    <!-- Bootstrap Core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="css/portfolio-item.css" rel="stylesheet">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body>

    <!-- Navigation -->

    <!-- Page Content -->
    <div class="container">

        <!-- Portfolio Item Heading -->
        <div class="row">
            <div class="col-lg-12">
                <h1 class="page-header">Duolingo e-mersion
                    <small>Using artifical intelligence to select songs when learning a new language</small>
                </h1>
            </div>
        </div>
        <!-- /.row -->

        <!-- Portfolio Item Row -->
        <div class="row">
            <div class="col-md-4">
                <h3>What to listen</h3>
                <p>You want to hear songs based on what words you know... fill in your Duolingo username here:</p>
              
            <input type="text" name="id_of_textbox" value="rmeertens" id="id_of_textbox">
            <button onclick="myFunction()">Search songs</button>
            </div>

        </div>
        <!-- /.row -->

        <!-- Related Projects Row -->
     <div class="row" id="test1">
  
       
</div>
        
        <div class="row featurette">
        <div class="col-md-7">
          <h2 class="featurette-heading">Contact me </h2>
          Do you have any questions? Want to help with beta testing? Can you contribute code? Should we clearly add this one songtext?
            Send a mail to rolandmeertens@gmail.com
        </div>
      </div>
    <!-- /.container -->

    <!-- jQuery -->
    <script src="js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="js/bootstrap.min.js"></script>

</body>
    <script>
   // document.getElementById("loading").style.display = "none";
</script>

</html>
