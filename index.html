<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>DuoMusico</title>
    <script src="http://code.jquery.com/jquery-latest.js"></script>
    <script>
        var test;



        $(document).ready(function() {
            $("#loadingNotification").hide();
            $("#errorNotification").hide();
            $("#explanation").hide();
        });

        function clearData() {
            $("#loadingNotification").hide();
            $("#errorNotification").hide();
            a = document.getElementById("test1");
            a.innerHTML = "";
        }

        function getDivArtistSongRating(nameAndArtist, index, mustDisplayScore) {

            // "<div class=\"col-sm-6 col-md-4\">\
            var toFill = "<div class=\"col-sm-6 col-md-4 myclass\" >\
                            <div class=\"thumbnail\" height: 648px>\
                            <div class=\"caption\">\
                            <h3><span class=\"glyphicon glyphicon-user\" aria-hidden=\"true\"></span>   " + nameAndArtist.Artist + "</h3>\
                            <h3><span class=\"glyphicon glyphicon-music\" aria-hidden=\"true\"></span>  " + nameAndArtist.NameSong + "</h3>";
            if (mustDisplayScore) {
                toFill += "<h3><span class=\"glyphicon glyphicon-dashboard\" aria-hidden=\"true\"></span>  " + nameAndArtist.Score + " percent</h3>";
            }
            toFill += "      </div>\
                            <div id=\"spotify" + index + "\"></div>\
                            </div>\
                            </div>";
            return toFill;

        }

        function placeResults(results, mustDisplayScore) {
            $("#loadingNotification").hide();
            $("#explanation").show();
            
            for (var index = 0; index < results.length; index++) {
                var nameAndArtist = results[index];
                var toAdd = getDivArtistSongRating(nameAndArtist, index, mustDisplayScore);
                a = document.getElementById("test1");
                a.innerHTML = a.innerHTML + toAdd;
                searchAlbums(nameAndArtist.NameSong + " " + nameAndArtist.Artist, index);
            }
        }

        function myFunction() {
            //document.getElementById("loading").style.display = "";
            clearData();
            $("#loadingNotification").show();

            $.ajax({
                type: "GET",
                url: "http://80.60.177.158:8002/duolingorecommendation?username=" + document.getElementById("id_of_textbox").value + "&random=false",
                contentType: "application/json; charset=UTF-8",
                dataType: "json",

                success: function(results) {
                    placeResults(results, true);
                },
                error: function(xhr, textStatus, errorThrown) {
                    $("#errorNotification").show();
                }
            });
        }

        function getRandomSongs() {
            clearData();
            $("#loadingNotification").show();
            $.ajax({
                type: "GET",
                url: "http://80.60.177.158:8002/duolingorecommendation?username=" + document.getElementById("id_of_textbox").value + "&random=true",
                contentType: "application/json; charset=UTF-8",
                dataType: "json",

                success: function(results) {

                    placeResults(results, true);

                },
                error: function(xhr, textStatus, errorThrown) {
                    $("#errorNotification").show();
                }
            });
        }

        function getRandomSongsInLanguage(language) {
            console.log("searching songs in language" + language);
            clearData();
            $("#loadingNotification").show();
            $.ajax({
                type: "GET",
                url: "http://80.60.177.158:8002/randomSong?language=" + language,

                contentType: "application/json; charset=UTF-8",
                dataType: "json",

                success: function(results) {
                    test = results;
                    placeResults(results, true);

                },
                error: function(xhr, textStatus, errorThrown) {
                    $("#error").html(xhr.responseText);
                }
            });
        }


        var searchAlbums = function(query, index) {
            $.ajax({
                url: 'https://api.spotify.com/v1/search',
                data: {
                    q: query,
                    type: 'track'
                },
                success: function(response) {
                    console.log("Response is: ");
                    console.log(response);

                    console.log("Element is: ");
                    console.log(index);
                    if (response.tracks.items.length > 0) {
                        document.getElementById("spotify" + index).innerHTML = "<iframe src=\"https://embed.spotify.com/?uri=spotify:track:" + response.tracks.items[0].id + "\" width=\"300\" height=\"380\" frameborder=\"0\" allowtransparency=\"true\"></iframe>";
                    } else {
                        document.getElementById("spotify" + index).innerHTML = "<img src=\"notfound.png\" alt=\"Oh no..\" style= \"width:300px;height:380px\">"
                    }
                }
            });
        };
    </script>
    <!-- Bootstrap Core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- Flags -->
    <link href="./css/flag-icon.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="css/portfolio-item.css" rel="stylesheet">


    <STYLE type="text/css">
        div.myclass {
            min-width: 350px
        }
        div.thumbnail {
            height: 648px
        }
    </STYLE>
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>

<body>

    <div class="jumbotron">
        <div class="container">
            <h1>DuoMusico</h1>
            <p>Using artifical intelligence to select songs when learning a new language</p>

        </div>
    </div>
    


    <section>
        <div class="container">
            
                <h3>What to listen</h3>
                <p>You want to hear songs based on what words you know... fill in your Duolingo username here:</p>

                <input type="text" name="id_of_textbox" value="rmeertens" id="id_of_textbox">
                <button onclick="myFunction()">Best songs</button>
                <button onclick="getRandomSongs()" id="getRandomSongsButton">Random songs</button>
            </div>
    </section>
    <section>
    <div class="container">
        <h1></h1>
        <div class="alert alert-info" role="alert" id="loadingNotification">Loading data...</div>
        <div class="alert alert-danger" role="alert" id="errorNotification">Something went wrong!</div>
        </div>
    </section>
    <section>
        <div class="container">
        
        <div id="explanation">
            <h3>What do the icons mean?</h3>
            <h5><span class="glyphicon glyphicon-user" aria-hidden="true"></span>   Artist name</h5>
            <h5><span class="glyphicon glyphicon-music" aria-hidden="true"></span>  Song name</h5>
            <h5><span class="glyphicon glyphicon-dashboard" aria-hidden="true"></span> The percentage of words you know</h5>
        </div>
        <!-- /.row -->
        <div id="test1"></div>
        <!-- Related Projects Row -->
        </div>
    </section>
    <div class="container">
        <section id="examples">
            <div class="page-header">
                <h1>Get random music in a specific language</h1>
            </div>
            <div class="no-wrap">
                <h1>
                    <span class="label label-primary" onclick=getRandomSongsInLanguage("fr")><span class="flag-icon flag-icon-fr"></span>French</span>
                    <span class="label label-primary" onclick=getRandomSongsInLanguage("sv")><span class="flag-icon flag-icon-se"></span>Swedish</span>
                    <span class="label label-primary" onclick=getRandomSongsInLanguage("en")><span class="flag-icon flag-icon-us"></span>English</span>
                    <span class="label label-primary" onclick=getRandomSongsInLanguage("de")><span class="flag-icon flag-icon-de"></span>German</span>
                    <span class="label label-primary" onclick=getRandomSongsInLanguage("it")><span class="flag-icon flag-icon-it"></span>Italian</span>
                    <span class="label label-primary" onclick=getRandomSongsInLanguage("es")><span class="flag-icon flag-icon-es"></span>Spanish</span>
                    <span class="label label-primary" onclick=getRandomSongsInLanguage("nl")><span class="flag-icon flag-icon-nl"></span>Dutch</span>
                </h1>
            </div>
        </section>


    </div>
    <footer class="footer">
        <div class="container">
            <div class="row featurette">
                <div class="col-md-7">
                    <h2 class="featurette-heading">Contact me </h2> Do you have any questions? Want to help with beta testing? Can you contribute code? Should we clearly add this one songtext? Send a mail to rolandmeertens@gmail.com
                </div>

            </div>
        </div>

    </footer>
    <!-- /.container -->

    <!-- jQuery -->
    <script src="js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="js/bootstrap.min.js"></script>

</body>
<script>
    // document.getElementById("loading").style.display = "none";
</script>

</html>